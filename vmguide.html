<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EVMC: EVMC VM Implementation Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">EVMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('vmguide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">EVMC VM Implementation Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_VM_Guide"></a> </p><blockquote class="doxtable">
<p>&zwj;How to add EVMC interface to Your Ethereum VM implementation. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md11"></a>
An example</h1>
<p>You can start with <a class="el" href="example__vm_8cpp.html">the example implementation of EVMC VM interface in C++</a>.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
VM instance</h1>
<p>The VM instance is described by the <a class="el" href="structevmc__vm.html" title="The VM instance.">evmc_vm</a> struct. It contains the basic static information about the VM like name and version. The struct also includes the VM methods (in form of function pointers) to allow the Host to interact with the VM.</p>
<p>Some methods are optional. The VM must implement at least all mandatory ones.</p>
<p>The instance struct must also include the EVMC ABI version (<a class="el" href="group__EVMC.html#gga06fc87d81c62e9abb8790b6e5713c55ba1db9144f8af4e62865f0c003c07a02bc" title="The EVMC ABI version number of the interface declared in this file.">EVMC_ABI_VERSION</a>) it was build with. This allows the Host to check the ABI compatibility when loading VMs dynamically.</p>
<p>The VM instance is created and returned as a pointer from a special "create" function. The EVMC recommends to name the function by the VM codename, e.g. <a class="el" href="group__EVMC.html#ga4ba5aae5d0250d9c4f6987a78602e795" title="Example of a function creating an instance of an example EVM implementation.">evmc_create_example_vm()</a>.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
VM methods implementation</h1>
<p>Each VM methods takes the pointer to the <a class="el" href="structevmc__vm.html" title="The VM instance.">evmc_vm</a> as the first argument. The VM implementation can extend the <a class="el" href="structevmc__vm.html" title="The VM instance.">evmc_vm</a> struct for storing internal data. This allow implementing the VM in object-oriented manner.</p>
<p>The most important method is <a class="el" href="structevmc__vm.html#a8384d28338f2287a9f9e1508699c53f0" title="Pointer to function executing a code by the VM instance.">evmc_vm::execute()</a> because it executes EVM code. Remember that the Host is allowed to invoke the execute method concurrently so do not store data related to a particular execution context in the VM instance.</p>
<p>Before a client can actually execute a VM, it is important to implement the three basic fields for querying name (<a class="el" href="structevmc__vm.html#ac29ccc98e89c8cab3ffc5bd51a2afaa8" title="The name of the EVMC VM implementation.">evmc_vm::name</a>), version (<a class="el" href="structevmc__vm.html#af98936c214ed16f5da05ba3d6a619faa" title="The version of the EVMC VM implementation, e.g.">evmc_vm::version</a>) and capabilities (<a class="el" href="structevmc__vm.html#a505d4e584a858c2eea7a026f3a94188b" title="A method returning capabilities supported by the VM instance.">evmc_vm::get_capabilities()</a>) as well as the <a class="el" href="structevmc__vm.html#ac78933134b4e14ca3dd4139ee061cc6b" title="Pointer to function destroying the VM instance.">evmc_vm::destroy()</a> method to wind the VM down.</p>
<p>Other methods are optional.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Resource management</h1>
<p>All additional resources allocated when the VM instance is created must be freed when the destroy method is invoked.</p>
<p>The VM implementation can also attach additional resources to the <a class="el" href="structevmc__result.html" title="The EVM code execution result.">evmc_result</a> of an execution. These resource must be freed when the <a class="el" href="structevmc__result.html#a8727ff83d372ab0067bcf6656d30b0ed" title="The method releasing all resources associated with the result object.">evmc_result::release()</a> method is invoked.</p>
<p><em>Have fun!</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Feb 7 2025 11:58:08 for EVMC by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
